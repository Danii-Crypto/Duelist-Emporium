<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cart Functionality - Duelist Emporium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body class="bg-slate-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ðŸ§ª Test Cart Functionality</h1>
        
        <!-- Test Product Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Test Product 1 -->
            <div class="bg-slate-800 rounded-xl p-4 border border-slate-600">
                <div class="aspect-square bg-slate-700 rounded-lg mb-4 flex items-center justify-center">
                    <i class="fas fa-box text-4xl text-slate-400"></i>
                </div>
                <h3 class="font-semibold mb-2">Test Deck Box</h3>
                <p class="text-yellow-400 font-bold mb-4">$24.99</p>
                <button 
                    onclick="testAddToCart(1, 'Test Deck Box', 24.99, 'https://example.com/image1.jpg')"
                    class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg transition-colors"
                >
                    <i class="fas fa-cart-plus mr-2"></i>
                    Add to Cart
                </button>
            </div>
            
            <!-- Test Product 2 -->
            <div class="bg-slate-800 rounded-xl p-4 border border-slate-600">
                <div class="aspect-square bg-slate-700 rounded-lg mb-4 flex items-center justify-center">
                    <i class="fas fa-layer-group text-4xl text-slate-400"></i>
                </div>
                <h3 class="font-semibold mb-2">Test Card Sleeves</h3>
                <p class="text-yellow-400 font-bold mb-4">$15.99</p>
                <button 
                    onclick="testAddToCart(2, 'Test Card Sleeves', 15.99, 'https://example.com/image2.jpg')"
                    class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg transition-colors"
                >
                    <i class="fas fa-cart-plus mr-2"></i>
                    Add to Cart
                </button>
            </div>
            
            <!-- Test Product 3 -->
            <div class="bg-slate-800 rounded-xl p-4 border border-slate-600">
                <div class="aspect-square bg-slate-700 rounded-lg mb-4 flex items-center justify-center">
                    <i class="fas fa-book text-4xl text-slate-400"></i>
                </div>
                <h3 class="font-semibold mb-2">Test Binder</h3>
                <p class="text-yellow-400 font-bold mb-4">$39.99</p>
                <button 
                    onclick="testAddToCart(3, 'Test Binder', 39.99, 'https://example.com/image3.jpg')"
                    class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg transition-colors"
                >
                    <i class="fas fa-cart-plus mr-2"></i>
                    Add to Cart
                </button>
            </div>
        </div>
        
        <!-- Cart Status -->
        <div class="bg-slate-800 rounded-xl p-6 border border-slate-600 mb-6">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-shopping-cart mr-2"></i>
                Cart Status
            </h2>
            <div id="cart-status" class="text-slate-300">
                Cart is empty
            </div>
            <button 
                onclick="viewCart()" 
                class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors"
            >
                <i class="fas fa-eye mr-2"></i>
                View Cart Details
            </button>
            <button 
                onclick="clearCart()" 
                class="mt-4 ml-4 bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors"
            >
                <i class="fas fa-trash mr-2"></i>
                Clear Cart
            </button>
        </div>
        
        <!-- Test Checkout -->
        <div class="bg-slate-800 rounded-xl p-6 border border-slate-600 mb-6">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-credit-card mr-2"></i>
                Test Checkout
            </h2>
            <button 
                onclick="testCheckout()" 
                class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors font-bold"
                disabled
                id="checkout-btn"
            >
                <i class="fas fa-paper-plane mr-2"></i>
                Test Checkout Process
            </button>
            <p class="text-sm text-slate-400 mt-2">Add items to cart to enable checkout test</p>
        </div>
        
        <!-- Navigation Links -->
        <div class="bg-slate-800 rounded-xl p-6 border border-slate-600">
            <h2 class="text-xl font-bold mb-4">
                <i class="fas fa-link mr-2"></i>
                Navigation
            </h2>
            <div class="flex flex-wrap gap-4">
                <a href="/" class="bg-yellow-600 hover:bg-yellow-700 text-black px-4 py-2 rounded-lg transition-colors font-semibold">
                    <i class="fas fa-home mr-2"></i>
                    Home
                </a>
                <a href="/shop" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors font-semibold">
                    <i class="fas fa-store mr-2"></i>
                    Shop
                </a>
                <a href="/cart" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors font-semibold">
                    <i class="fas fa-shopping-cart mr-2"></i>
                    Cart
                </a>
                <a href="/checkout" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors font-semibold">
                    <i class="fas fa-credit-card mr-2"></i>
                    Checkout
                </a>
            </div>
        </div>
    </div>

    <script>
        // Simple cart for testing
        let testCart = JSON.parse(localStorage.getItem('duelistCart')) || [];
        
        function testAddToCart(id, name, price, image) {
            console.log('Adding to cart:', { id, name, price, image });
            
            const existingItem = testCart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                testCart.push({ id, name, price, image, quantity: 1 });
            }
            
            localStorage.setItem('duelistCart', JSON.stringify(testCart));
            updateCartStatus();
            showNotification(`${name} added to cart!`);
        }
        
        function updateCartStatus() {
            const statusEl = document.getElementById('cart-status');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            if (testCart.length === 0) {
                statusEl.innerHTML = 'Cart is empty';
                checkoutBtn.disabled = true;
            } else {
                const totalItems = testCart.reduce((sum, item) => sum + item.quantity, 0);
                const totalPrice = testCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                statusEl.innerHTML = `
                    <strong>${totalItems} items</strong> - <strong>$${totalPrice.toFixed(2)}</strong><br>
                    <small class="text-slate-400">${testCart.map(item => `${item.name} (${item.quantity}x)`).join(', ')}</small>
                `;
                checkoutBtn.disabled = false;
            }
        }
        
        function viewCart() {
            console.log('Current cart:', testCart);
            alert(`Cart Contents:\n${testCart.map(item => `â€¢ ${item.name} - $${item.price} x ${item.quantity}`).join('\n')}`);
        }
        
        function clearCart() {
            testCart = [];
            localStorage.removeItem('duelistCart');
            updateCartStatus();
            showNotification('Cart cleared!');
        }
        
        function testCheckout() {
            if (testCart.length === 0) return;
            
            const orderData = {
                firstName: 'Test',
                lastName: 'User',
                email: 'test@example.com',
                phone: '+1-555-0123',
                address: '123 Test Street',
                city: 'Test City',
                state: 'Test State',
                zipCode: '12345',
                country: 'Test Country',
                orderNotes: 'This is a test order from the test page',
                cartItems: testCart,
                subtotal: testCart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                shipping: 0,
                total: testCart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
            };
            
            console.log('Testing checkout with data:', orderData);
            
            axios.post('/api/orders', orderData)
                .then(response => {
                    console.log('Checkout response:', response.data);
                    if (response.data.success) {
                        showNotification(`Order ${response.data.orderNumber} created successfully!`);
                        clearCart();
                        
                        // Optionally navigate to confirmation page
                        if (confirm('Order created! Go to confirmation page?')) {
                            window.location.href = `/order-confirmation/${response.data.orderNumber}`;
                        }
                    }
                })
                .catch(error => {
                    console.error('Checkout error:', error);
                    showNotification('Checkout failed! Check console for details.');
                });
        }
        
        function showNotification(message) {
            // Simple notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Initialize on load
        updateCartStatus();
    </script>
</body>
</html>